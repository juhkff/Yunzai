import{d as defineComponent,r as ref,g2 as useDraggable,w as watch,L as watchEffect,C as computed,c as resolveComponent,o as openBlock,e as createElementBlock,j as createVNode,i as withCtx,v as createBaseVNode,k as createTextVNode,W as normalizeStyle,h as createBlock,aW as resolveDynamicComponent,F as Fragment,f as renderList,z as normalizeClass,m as toDisplayString,y as unref,bo as Modal,g3 as api,O as pushScopeId,Q as popScopeId,A as useMessage,b as _export_sfc}from"./index.js";import IconUploader from"./IconUploader.js";import"./esm.js";const _hoisted_1=(n=>(pushScopeId("data-v-4754d4fb"),n=n(),popScopeId(),n))((()=>createBaseVNode("span",{class:"tip"},"按住这里可拖动",-1))),_hoisted_2={class:"icon-view-wrap"},_hoisted_3={class:"icon-view"},_hoisted_4=["onClick"],SelectIconModal=_export_sfc(defineComponent({__name:"SelectIconModal",props:{visible:Boolean,cell:Object,iconB64List:Array},emits:["update:visible"],setup(__props,{emit:__emit}){const props=__props,emits=__emit,{createMessage:$message}=useMessage(),edit=ref(!1),uploader=ref({show:!1,selected:null}),closeModal=()=>{emits("update:visible",!1)},switchEdit=()=>{edit.value=!edit.value,edit.value&&api.info("请点击想要替换的图标")},modalTitleRef=ref(null),{x:x,y:y,isDragging:isDragging}=useDraggable(modalTitleRef),startX=ref(0),startY=ref(0),startedDrag=ref(!1),transformX=ref(0),transformY=ref(0),preTransformX=ref(0),preTransformY=ref(0),dragRect=ref({left:0,right:0,top:0,bottom:0});watch([x,y],(()=>{if(!startedDrag.value){startX.value=x.value,startY.value=y.value;const bodyRect=document.body.getBoundingClientRect(),titleRect=modalTitleRef.value.getBoundingClientRect();dragRect.value.right=bodyRect.width-titleRect.width,dragRect.value.bottom=bodyRect.height-titleRect.height,preTransformX.value=transformX.value,preTransformY.value=transformY.value}startedDrag.value=!0})),watch(isDragging,(()=>{isDragging||(startedDrag.value=!1)})),watchEffect((()=>{startedDrag.value&&(transformX.value=preTransformX.value+Math.min(Math.max(dragRect.value.left,x.value),dragRect.value.right)-startX.value,transformY.value=preTransformY.value+Math.min(Math.max(dragRect.value.top,y.value),dragRect.value.bottom)-startY.value)}));const transformStyle=computed((()=>({transform:`translate(${transformX.value}px, ${transformY.value}px)`})));function addLine(){let iconB64List=props.iconB64List,flag=!1;for(let i=1;i<iconB64List.length;i++)if(!iconB64List[i]){flag=!0;break}flag?$message.warn("仍有未利用的空白图标，无法继续添加"):iconB64List.push(...Array(10).fill(""))}return(_ctx,_cache)=>{const _component_a_button=resolveComponent("a-button"),_component_a_space=resolveComponent("a-space");return openBlock(),createElementBlock(Fragment,null,[createVNode(unref(Modal),{visible:__props.visible,onCancel:closeModal,width:"420px",closable:!1,footer:null,mask:!1,"onUpdate:visible":_cache[0]||(_cache[0]=$event=>emits("update:visible",$event))},{title:withCtx((()=>[createBaseVNode("div",{ref_key:"modalTitleRef",ref:modalTitleRef,style:{width:"100%",cursor:"move"}},[createTextVNode(" 选择图标 "),_hoisted_1],512)])),modalRender:withCtx((({originVNode:originVNode})=>[createBaseVNode("div",{style:normalizeStyle(transformStyle.value)},[(openBlock(),createBlock(resolveDynamicComponent(originVNode)))],4)])),default:withCtx((()=>[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(new Array(__props.iconB64List.length-1).toString().split(","),((_,idx)=>(openBlock(),createElementBlock("div",{class:normalizeClass(edit.value?"edit-icon":"medium-icon"),style:normalizeStyle({background:`url(${__props.iconB64List[idx+1]}) 0 0 no-repeat`,backgroundSize:"50px 50px"}),onClick:$event=>{return k=idx,void(edit.value?(uploader.value.show=!0,uploader.value.selected=k+1):(props.cell.icon=k+1,emits("update:visible",!1)));var k}},null,14,_hoisted_4)))),256)),createVNode(_component_a_space,{class:"add-icon",style:{padding:"10px",width:"100%"}},{default:withCtx((()=>[createVNode(_component_a_button,{type:edit.value?"danger":"success",onClick:switchEdit},{default:withCtx((()=>[createTextVNode(toDisplayString(edit.value?"完成":"替换图标"),1)])),_:1},8,["type"]),createVNode(_component_a_button,{type:"primary",onClick:addLine},{default:withCtx((()=>[createTextVNode("添加10个空图标")])),_:1})])),_:1})])])])),_:1},8,["visible"]),createVNode(IconUploader,{uploader:uploader.value,iconB64List:__props.iconB64List},null,8,["uploader","iconB64List"])],64)}}}),[["__scopeId","data-v-4754d4fb"]]);export{SelectIconModal as default};
