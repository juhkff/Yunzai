var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value:value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__async=(__this,__arguments,generator)=>new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));import{B as BasicDrawer,u as useDrawerInner}from"./index35.js";import{d as defineComponent,K as useAttrs,r as ref,C as computed,y as unref,A as useMessage,u as usePrompt,b as _export_sfc,c as resolveComponent,o as openBlock,h as createBlock,i as withCtx,j as createVNode,v as createBaseVNode,k as createTextVNode,m as toDisplayString,e as createElementBlock,x as createCommentVNode,a0 as normalizeProps,a1 as guardReactiveProps}from"./index.js";import"./index19.js";/* empty css       *//* empty css                                                          */import{a as getBackupList,b as addBackup,r as restoreBackup,d as deleteBackup}from"./miao.api.js";import"./index29.js";import"./ArrowLeftOutlined.js";import"./useWindowSizeFn.js";import"./FullscreenOutlined.js";import"./base64Conver.js";const _sfc_main=defineComponent({name:"BackupDrawer",components:{BasicDrawer:BasicDrawer},emits:["register","reload"],setup(props,{emit:emit}){const attrs=useAttrs(),{createMessage:$message,createConfirm:createConfirm}=useMessage(),{createPrompt:createPrompt}=usePrompt(),loading=ref(!1),backupList=ref([]),[registerDrawer,{closeDrawer:closeDrawer,setDrawerProps:setDrawerProps}]=useDrawerInner((function(){loadData()}));function loadData(){return __async(this,null,(function*(){try{setLoading(!0),backupList.value=(yield getBackupList()).reverse()}finally{setLoading(!1)}}))}function close(){closeDrawer()}function setLoading(flag){loading.value=flag,setDrawerProps({confirmLoading:flag})}return{getProps:computed((()=>{let drawerProps={width:document.body.clientWidth>=768?700:"100%",title:"喵喵帮助备份",confirmLoading:unref(loading)};var a;return a=__spreadValues(__spreadValues(__spreadValues({},unref(attrs)),drawerProps),props),__defProps(a,__getOwnPropDescs({onOk:close,onCancel:close,onRegister:registerDrawer}))})),loading:loading,backupList:backupList,onAdd:function(){createPrompt({title:"新增备份",required:!0,placeholder:"请输入备份名称",bottomHelpMessage:"注：新版备份只会备份配置和图标，背景图片请使用“皮肤”功能。",onOk(value){return __async(this,null,(function*(){yield addBackup(value),yield loadData()}))}})},onRollback:function(item){return __async(this,null,(function*(){let reload=!1;if(2===item.version||(reload=yield new Promise((resolve=>{createConfirm({iconType:"warning",title:"备份版本过低",content:"当前备份为旧版备份，是否要转换为新版备份？",onOk:()=>resolve(!0),onCancel:()=>resolve(!1)})})),reload))try{setLoading(!0),yield restoreBackup(item.id),reload&&(yield loadData()),emit("reload")}finally{setLoading(!1)}}))},onDelete:function(item){return __async(this,null,(function*(){try{setLoading(!0),yield deleteBackup(item.id),yield loadData()}finally{setLoading(!1)}}))}}}}),_hoisted_1={style:{"margin-bottom":"8px"}},_hoisted_2={key:0,class:"remark-old"};const BackupDrawer=_export_sfc(_sfc_main,[["render",function(_ctx,_cache,$props,$setup,$data,$options){const _component_a_button=resolveComponent("a-button"),_component_a_popconfirm=resolveComponent("a-popconfirm"),_component_a_list_item_meta=resolveComponent("a-list-item-meta"),_component_a_list_item=resolveComponent("a-list-item"),_component_a_list=resolveComponent("a-list"),_component_a_spin=resolveComponent("a-spin"),_component_BasicDrawer=resolveComponent("BasicDrawer");return openBlock(),createBlock(_component_BasicDrawer,normalizeProps(guardReactiveProps(_ctx.getProps)),{default:withCtx((()=>[createVNode(_component_a_spin,{wrapperClassName:"p-2",spinning:_ctx.loading},{default:withCtx((()=>[createBaseVNode("div",_hoisted_1,[createVNode(_component_a_button,{type:"primary",preIcon:"ant-design:plus",onClick:_ctx.onAdd},{default:withCtx((()=>[createTextVNode("新增备份")])),_:1},8,["onClick"])]),createVNode(_component_a_list,{size:"large",bordered:"",dataSource:_ctx.backupList},{renderItem:withCtx((({item:item})=>[createVNode(_component_a_list_item,null,{actions:withCtx((()=>[createVNode(_component_a_popconfirm,{title:"确定要还原吗？",placement:"left",onConfirm:()=>_ctx.onRollback(item)},{default:withCtx((()=>[createVNode(_component_a_button,{type:"primary",shape:"circle",preIcon:"ant-design:undo"})])),_:2},1032,["onConfirm"]),createVNode(_component_a_popconfirm,{title:"确定要删除吗？",placement:"left",onConfirm:()=>_ctx.onDelete(item)},{default:withCtx((()=>[createVNode(_component_a_button,{type:"primary",shape:"circle",danger:"",preIcon:"ant-design:delete"})])),_:2},1032,["onConfirm"])])),default:withCtx((()=>[createVNode(_component_a_list_item_meta,{description:item.time},{title:withCtx((()=>[createBaseVNode("span",null,toDisplayString(item.remark),1),2!==item.version?(openBlock(),createElementBlock("span",_hoisted_2,"OLD")):createCommentVNode("",!0)])),_:2},1032,["description"])])),_:2},1024)])),_:1},8,["dataSource"])])),_:1},8,["spinning"])])),_:1},16)}],["__scopeId","data-v-ce9b1510"]]);export{BackupDrawer as default};
