var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value:value}):obj[key]=value;import{j as createVNode,I as Icon,a as reactive,by as tryOnMounted,bk as tryOnUnmounted,t as toRefs,bI as dateUtil,d as defineComponent,d7 as Input,r as ref,E as useDesign,a3 as useUserStore,C as computed,c as resolveComponent,o as openBlock,e as createElementBlock,T as withDirectives,X as vShow,v as createBaseVNode,y as unref,m as toDisplayString,z as normalizeClass,i as withCtx,x as createCommentVNode,k as createTextVNode,aV as Transition,a9 as useI18n,b as _export_sfc}from"./index.js";import{u as useLockStore}from"./lock.js";import{h as headerImg}from"./header.js";var LockOutlined$1={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?Object(arguments[i]):{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter((function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable})))),ownKeys.forEach((function(key){_defineProperty(target,key,source[key])}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var LockOutlined=function(props,context){var p=_objectSpread({},props,context.attrs);return createVNode(Icon,_objectSpread({},p,{icon:LockOutlined$1}),null)};function useNow(immediate=!0){let timer;const state=reactive({year:0,month:0,week:"",day:0,hour:"",minute:"",second:0,meridiem:""}),update=()=>{const now=dateUtil(),h=now.format("HH"),m=now.format("mm"),s=now.get("s");state.year=now.get("y"),state.month=now.get("M")+1,state.week="星期"+["日","一","二","三","四","五","六"][now.day()],state.day=now.get("date"),state.hour=h,state.minute=m,state.second=s,state.meridiem=now.format("A")};function start(){update(),clearInterval(timer),timer=setInterval((()=>update()),1e3)}function stop(){clearInterval(timer)}return tryOnMounted((()=>{immediate&&start()})),tryOnUnmounted((()=>{stop()})),a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a})({},toRefs(state)),__defProps(a,__getOwnPropDescs({start:start,stop:stop}));var a}LockOutlined.displayName="LockOutlined",LockOutlined.inheritAttrs=!1;const _hoisted_1={class:"flex w-screen h-screen justify-center items-center"},_hoisted_2=["src"],_hoisted_3={class:"absolute bottom-5 w-full text-gray-300 xl:text-xl 2xl:text-3xl text-center enter-y"},_hoisted_4={class:"text-5xl mb-4 enter-x"},_hoisted_5={class:"text-3xl"},_hoisted_6={class:"text-2xl"},LockPage=_export_sfc(defineComponent({__name:"LockPage",setup(__props){const InputPassword=Input.Password,password=ref(""),loading=ref(!1),errMsg=ref(!1),showDate=ref(!0),{prefixCls:prefixCls}=useDesign("lock-page"),lockStore=useLockStore(),userStore=useUserStore(),{hour:hour,month:month,minute:minute,meridiem:meridiem,year:year,day:day,week:week}=useNow(!0),{t:t}=useI18n(),userinfo=computed((()=>userStore.getUserInfo||{}));function unLock(){return __this=this,__arguments=null,generator=function*(){if(!password.value)return;let pwd=password.value;try{loading.value=!0;const res=yield lockStore.unLock(pwd);errMsg.value=!res}finally{loading.value=!1}},new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));var __this,__arguments,generator}function goLogin(){userStore.logout(!0),lockStore.resetLockInfo()}function handleShowForm(show=!1){showDate.value=show}return(_ctx,_cache)=>{const _component_a_button=resolveComponent("a-button");return openBlock(),createElementBlock("div",{class:normalizeClass([unref(prefixCls),"fixed inset-0 flex h-screen w-screen bg-black items-center justify-center"])},[withDirectives(createBaseVNode("div",{class:normalizeClass([`${unref(prefixCls)}__unlock`,"absolute top-0 left-1/2 flex pt-5 h-16 items-center justify-center sm:text-md xl:text-xl text-white flex-col cursor-pointer transform translate-x-1/2"]),onClick:_cache[0]||(_cache[0]=$event=>handleShowForm(!1))},[createVNode(unref(LockOutlined)),createBaseVNode("span",null,toDisplayString(unref(t)("sys.lock.unlock")),1)],2),[[vShow,showDate.value]]),createBaseVNode("div",_hoisted_1,[createBaseVNode("div",{class:normalizeClass([`${unref(prefixCls)}__hour`,"relative mr-5 md:mr-20 w-2/5 h-2/5 md:h-4/5"])},[createBaseVNode("span",null,toDisplayString(unref(hour)),1),withDirectives(createBaseVNode("span",{class:"meridiem absolute left-5 top-5 text-md xl:text-xl"},toDisplayString(unref(meridiem)),513),[[vShow,showDate.value]])],2),createBaseVNode("div",{class:normalizeClass(`${unref(prefixCls)}__minute w-2/5 h-2/5 md:h-4/5 `)},[createBaseVNode("span",null,toDisplayString(unref(minute)),1)],2)]),createVNode(Transition,{name:"fade-slide"},{default:withCtx((()=>[withDirectives(createBaseVNode("div",{class:normalizeClass(`${unref(prefixCls)}-entry`)},[createBaseVNode("div",{class:normalizeClass(`${unref(prefixCls)}-entry-content`)},[createBaseVNode("div",{class:normalizeClass(`${unref(prefixCls)}-entry__header enter-x`)},[createBaseVNode("img",{src:userinfo.value.avatar||unref(headerImg),class:normalizeClass(`${unref(prefixCls)}-entry__header-img`)},null,10,_hoisted_2),createBaseVNode("p",{class:normalizeClass(`${unref(prefixCls)}-entry__header-name`)},toDisplayString(userinfo.value.realName),3)],2),createVNode(unref(InputPassword),{placeholder:unref(t)("sys.lock.placeholder"),class:"enter-x",value:password.value,"onUpdate:value":_cache[1]||(_cache[1]=$event=>password.value=$event)},null,8,["placeholder","value"]),errMsg.value?(openBlock(),createElementBlock("span",{key:0,class:normalizeClass(`${unref(prefixCls)}-entry__err-msg enter-x`)},toDisplayString(unref(t)("sys.lock.alert")),3)):createCommentVNode("",!0),createBaseVNode("div",{class:normalizeClass(`${unref(prefixCls)}-entry__footer enter-x`)},[createVNode(_component_a_button,{type:"link",size:"small",class:"mt-2 mr-2 enter-x",disabled:loading.value,onClick:_cache[2]||(_cache[2]=$event=>handleShowForm(!0))},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(t)("common.back")),1)])),_:1},8,["disabled"]),createVNode(_component_a_button,{type:"link",size:"small",class:"mt-2 mr-2 enter-x",disabled:loading.value,onClick:goLogin},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(t)("sys.lock.backToLogin")),1)])),_:1},8,["disabled"]),createVNode(_component_a_button,{class:"mt-2",type:"link",size:"small",onClick:_cache[3]||(_cache[3]=$event=>unLock()),loading:loading.value},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(t)("sys.lock.entry")),1)])),_:1},8,["loading"])],2)],2)],2),[[vShow,!showDate.value]])])),_:1}),createBaseVNode("div",_hoisted_3,[withDirectives(createBaseVNode("div",_hoisted_4,[createTextVNode(toDisplayString(unref(hour))+":"+toDisplayString(unref(minute))+" ",1),createBaseVNode("span",_hoisted_5,toDisplayString(unref(meridiem)),1)],512),[[vShow,!showDate.value]]),createBaseVNode("div",_hoisted_6,toDisplayString(unref(year))+"/"+toDisplayString(unref(month))+"/"+toDisplayString(unref(day))+" "+toDisplayString(unref(week)),1)])],2)}}}),[["__scopeId","data-v-2e6de2fa"]]);export{LockPage as default};
