var __async=(__this,__arguments,generator)=>new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));import{d as defineComponent,r as ref,C as computed,an as onMounted,w as watch,n as nextTick,c as resolveComponent,o as openBlock,e as createElementBlock,j as createVNode,y as unref,N as LoadingOutlined,v as createBaseVNode,h as createBlock,k as createTextVNode,i as withCtx,x as createCommentVNode,F as Fragment,a5 as defHttp,O as pushScopeId,Q as popScopeId,A as useMessage,b as _export_sfc}from"./index.js";import{P as Progress,A as Alert}from"./BasicForm.vue_vue_type_style_index_0_lang.js";import{u as useStepStore}from"./hooks.js";import"./index21.js";import"./index22.js";import"./useFormItem.js";/* empty css       */import"./DeleteOutlined.js";import"./transButton.js";import"./index19.js";import"./useWindowSizeFn.js";import"./FullscreenOutlined.js";import"./upperFirst.js";import"./download.js";import"./index23.js";import"./index24.js";import"./lodash.default.js";import"./throttle.js";import"./merge.js";import"./uniqBy.js";const _withScopeId=n=>(pushScopeId("data-v-3c2d06c4"),n=n(),popScopeId(),n),_hoisted_1={class:"step-box"},_hoisted_2={key:0,class:"step-tip"},_hoisted_3={key:1,class:"step-tip"},_hoisted_4={key:2,class:"step-tip"},_hoisted_5=_withScopeId((()=>createBaseVNode("span",null,"正在迁移中",-1))),_hoisted_6=_withScopeId((()=>createBaseVNode("br",null,null,-1))),_hoisted_7=_withScopeId((()=>createBaseVNode("br",null,null,-1))),_hoisted_8={style:{width:"90%"}},_hoisted_9=_withScopeId((()=>createBaseVNode("br",null,null,-1))),Step2=_export_sfc(defineComponent({__name:"Step2",setup(__props){const{createConfirm:createConfirm}=useMessage(),stepStore=useStepStore(),logRef=ref(),failed=computed((()=>3===stepStore.status.state)),reason=computed((()=>stepStore.status.reason)),percent=computed((()=>stepStore.status.percent)),logs=computed((()=>stepStore.status.logs.join("\n")));function onCancel(){createConfirm({title:"取消迁移",iconType:"warning",content:"确定要取消迁移吗？取消后不会删除已迁移的文件，但下次迁移时就只能从头开始了。",onOk(){return __async(this,null,(function*(){yield defHttp.put({url:"/v2-transfer/stop"}),yield stepStore.updateStatus()}))}})}function onBack(){createConfirm({title:"返回",iconType:"warning",content:"确定要重置迁移状态并返回吗？",onOk(){return __async(this,null,(function*(){yield defHttp.post({url:"/v2-transfer/reset"}),yield stepStore.updateStatus()}))}})}return onMounted((()=>{!function(){watch(logs,(()=>__async(this,null,(function*(){var _a,_b;if(yield nextTick(),null==(_b=null==(_a=logRef.value)?void 0:_a.resizableTextArea)?void 0:_b.textArea){let textArea=logRef.value.resizableTextArea.textArea;textArea.scrollTop=textArea.scrollHeight}}))),{immediate:!0,deep:!0})}(),watch([percent,failed],(()=>{percent.value>=100||failed.value?stepStore.stopPolling():stepStore.startPolling()}),{immediate:!0})})),(_ctx,_cache)=>{const _component_a_textarea=resolveComponent("a-textarea"),_component_a_button=resolveComponent("a-button"),_component_a_col=resolveComponent("a-col"),_component_a_row=resolveComponent("a-row");return openBlock(),createElementBlock("div",_hoisted_1,[failed.value?(openBlock(),createElementBlock("div",_hoisted_2,"迁移失败")):100===percent.value?(openBlock(),createElementBlock("div",_hoisted_3,"迁移成功")):(openBlock(),createElementBlock("div",_hoisted_4,[_hoisted_5,createVNode(unref(LoadingOutlined))])),_hoisted_6,createVNode(unref(Progress),{type:"circle",percent:percent.value,status:failed.value?"exception":void 0},null,8,["percent","status"]),_hoisted_7,createBaseVNode("div",_hoisted_8,[failed.value?(openBlock(),createBlock(unref(Alert),{key:0,message:`迁移失败：${reason.value}`,type:"error","show-icon":""},null,8,["message"])):100===percent.value?(openBlock(),createBlock(unref(Alert),{key:1,message:"迁移成功！快去愉快地玩耍吧！",type:"success","show-icon":""})):(openBlock(),createBlock(unref(Alert),{key:2,message:"在迁移结束之前，请勿重启或关闭云崽",type:"warning","show-icon":""})),_hoisted_9,createTextVNode(" 迁移日志： "),createVNode(_component_a_textarea,{ref_key:"logRef",ref:logRef,value:logs.value,"auto-size":{minRows:10,maxRows:10}},null,8,["value"]),100!==percent.value?(openBlock(),createBlock(_component_a_row,{key:3,class:"footer-btn"},{default:withCtx((()=>[createVNode(_component_a_col,{span:12},{default:withCtx((()=>[failed.value?(openBlock(),createBlock(_component_a_button,{key:0,type:"link",preIcon:"ant-design:undo",onClick:onBack},{default:withCtx((()=>[createTextVNode(" 返回重新选择配置 ")])),_:1})):createCommentVNode("",!0)])),_:1}),createVNode(_component_a_col,{span:12,style:{"text-align":"right"}},{default:withCtx((()=>[failed.value?(openBlock(),createElementBlock(Fragment,{key:0},[],64)):(openBlock(),createBlock(_component_a_button,{key:1,type:"link",danger:"",preIcon:"ant-design:close-circle",onClick:onCancel},{default:withCtx((()=>[createTextVNode(" 取消迁移 ")])),_:1}))])),_:1})])),_:1})):createCommentVNode("",!0)])])}}}),[["__scopeId","data-v-3c2d06c4"]]);export{Step2 as default};
