var __async=(__this,__arguments,generator)=>new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));import{d as defineComponent,E as useDesign,r as ref,a as reactive,fm as ExceptionEnum,C as computed,a4 as router,c as resolveComponent,o as openBlock,e as createElementBlock,h as createBlock,y as unref,f_ as Skeleton,j as createVNode,i as withCtx,v as createBaseVNode,m as toDisplayString,a2 as Icon,F as Fragment,f as renderList,x as createCommentVNode,z as normalizeClass}from"./index.js";import{P as PageWrapper}from"./index30.js";import{_ as _sfc_main$1}from"./Exception.vue_vue_type_style_index_0_lang.js";import{u as useGuobaStore}from"./index34.js";import{P as PluginConfigForm,G as GPluginModal}from"./GPluginModal.js";import{a as useModal}from"./index19.js";import{_ as _sfc_main$2}from"./PluginIcon.vue_vue_type_style_index_0_lang.js";import"./index32.js";import"./onMountedOrActivated.js";import"./useWindowSizeFn.js";import"./useContentViewHeight.js";import"./ArrowLeftOutlined.js";import"./transButton.js";import"./index31.js";import"./MarkdownViewer.vue_vue_type_script_setup_true_lang.js";import"./guoba.js";import"./BasicForm.js";import"./BasicForm.vue_vue_type_style_index_0_lang.js";import"./index21.js";import"./index22.js";import"./useFormItem.js";/* empty css       */import"./DeleteOutlined.js";import"./upperFirst.js";import"./download.js";import"./index23.js";import"./index24.js";import"./uniqBy.js";import"./FullscreenOutlined.js";import"./lodash.default.js";import"./throttle.js";import"./merge.js";import"./common.js";const _hoisted_1={key:1},_hoisted_2={class:"plugin-title"},_hoisted_3=["href"],_hoisted_4={class:"plugin-content"},_hoisted_5={class:"content-desc ellipsis"},_hoisted_6={class:"ellipsis",style:{"max-width":"120px"}},_hoisted_7=createBaseVNode("span",null,"保存",-1),_hoisted_8={style:{"text-align":"center"}},_hoisted_9=createBaseVNode("span",null,"保存",-1),_sfc_main=defineComponent({__name:"index",setup(__props){const{prefixCls:prefixCls}=useDesign("plugin-detail"),guobaStore=useGuobaStore(),configFormRef=ref(),loading=ref(!0),pageLoading=ref(!0),errorRef=reactive({isError:!1,status:ExceptionEnum.PAGE_NOT_FOUND,title:"404",message:"未找到该插件"}),name=computed((()=>{var _a,_b;return null!=(_b=null==(_a=router.currentRoute.value.params)?void 0:_a.name)?_b:""})),plugin=ref();!function(){__async(this,null,(function*(){try{if(!name.value)return errorRef.isError=!0,errorRef.title="非法的插件名",errorRef.message="遇到该问题请刷新页面重试！",void(errorRef.status=ExceptionEnum.ERROR);const find=(yield guobaStore.getPlugins()).find((item=>item.name===name.value));if(!find)return errorRef.isError=!0,errorRef.title="插件不存在",void(errorRef.message=" ");if(!find.installed)return errorRef.isError=!0,errorRef.status=ExceptionEnum.PAGE_NOT_DATA,errorRef.title="插件未安装",void(errorRef.message=" ");plugin.value=find}finally{pageLoading.value=!1,loading.value=!1}}))}();const activeGroupKey=ref("default"),groupList=ref([]);function onSave(){return __async(this,null,(function*(){try{loading.value=!0,yield configFormRef.value.savePluginConfigData()}finally{loading.value=!1}}))}const[registerModal,{openModal:openModal}]=useModal();function onOpenPluginModal(){openModal(!0,{plugin:plugin.value})}return(_ctx,_cache)=>{const _component_a_tab_pane=resolveComponent("a-tab-pane"),_component_a_tabs=resolveComponent("a-tabs"),_component_a_col=resolveComponent("a-col"),_component_a_button=resolveComponent("a-button"),_component_a_row=resolveComponent("a-row"),_component_a_card=resolveComponent("a-card");return openBlock(),createElementBlock("div",{class:normalizeClass([unref(prefixCls)])},[pageLoading.value?(openBlock(),createBlock(unref(Skeleton),{key:0,active:""})):errorRef.isError?(openBlock(),createElementBlock("div",_hoisted_1,[createVNode(unref(_sfc_main$1),{status:errorRef.status,title:errorRef.title,subTitle:errorRef.message,btnText:"返回插件管理",goPath:"/plugins"},null,8,["status","title","subTitle"])])):(openBlock(),createBlock(unref(PageWrapper),{key:2,loading:loading.value,sticky:"",stickyTop:"-50px"},{title:withCtx((()=>[createBaseVNode("div",_hoisted_2,[createVNode(_sfc_main$2,{plugin:plugin.value,size:24},null,8,["plugin"]),createBaseVNode("a",{class:"title-name",onClick:onOpenPluginModal},toDisplayString(plugin.value.title),1),createBaseVNode("a",{href:plugin.value.link,target:"_blank",style:{"margin-left":"4px"}},[createVNode(unref(Icon),{icon:"bx:link",style:{"font-size":"20px"}})],8,_hoisted_3)])])),headerContent:withCtx((()=>[createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,toDisplayString(plugin.value.description),1)])])),footer:withCtx((()=>[createVNode(_component_a_row,null,{default:withCtx((()=>[createVNode(_component_a_col,{xxl:22,xl:22,lg:20,md:20,sm:19,xs:17},{default:withCtx((()=>[groupList.value.length>0?(openBlock(),createBlock(_component_a_tabs,{key:0,activeKey:activeGroupKey.value,"onUpdate:activeKey":_cache[0]||(_cache[0]=$event=>activeGroupKey.value=$event)},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(groupList.value,(group=>(openBlock(),createBlock(_component_a_tab_pane,{key:group.name},{tab:withCtx((()=>[createBaseVNode("div",_hoisted_6,toDisplayString(group.title),1)])),_:2},1024)))),128))])),_:1},8,["activeKey"])):createCommentVNode("",!0)])),_:1}),createVNode(_component_a_col,{xxl:2,xl:2,lg:4,md:4,sm:5,xs:7,style:{"text-align":"right","padding-bottom":"8px"}},{default:withCtx((()=>[createVNode(_component_a_button,{type:"primary","pre-icon":"ant-design:save",onClick:onSave},{default:withCtx((()=>[_hoisted_7])),_:1})])),_:1})])),_:1})])),default:withCtx((()=>[createVNode(_component_a_row,{justify:"center"},{default:withCtx((()=>[createVNode(_component_a_col,{xxl:16,xl:18,lg:20,md:22,sm:24,xs:24},{default:withCtx((()=>[createVNode(_component_a_card,null,{default:withCtx((()=>[createVNode(PluginConfigForm,{ref_key:"configFormRef",ref:configFormRef,"soft-grouping":"",activeGroupKey:activeGroupKey.value,"onUpdate:activeGroupKey":_cache[1]||(_cache[1]=$event=>activeGroupKey.value=$event),softGroupList:groupList.value,"onUpdate:softGroupList":_cache[2]||(_cache[2]=$event=>groupList.value=$event),plugin:plugin.value},null,8,["activeGroupKey","softGroupList","plugin"]),createBaseVNode("div",_hoisted_8,[createVNode(_component_a_button,{type:"primary","pre-icon":"ant-design:save",onClick:onSave},{default:withCtx((()=>[_hoisted_9])),_:1})])])),_:1})])),_:1})])),_:1}),createVNode(GPluginModal,{onRegister:unref(registerModal)},null,8,["onRegister"])])),_:1},8,["loading"]))],2)}}});export{_sfc_main as default};
