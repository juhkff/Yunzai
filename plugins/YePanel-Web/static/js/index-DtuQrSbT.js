import{f as ge,h as ke,i as ye,j as Ce,k as xe}from"./database-TArL9_M6.js";import{d as we,e as n,H as A,D as Ve,u as i,P as a,A as u,V as De,i as s,y as o,b as x,B as p,c as I,q,F as R,w as z,aT as Se,aB as $e,aO as N,C as Z,x as ee,aF as V,aR as le,k as ae,_ as Ie}from"./index-C1DCms5E.js";import{_ as qe}from"./add.vue_vue_type_script_setup_true_lang-DtAATYpZ.js";import{_ as Re}from"./sql.vue_vue_type_script_setup_true_lang-CgkfVo31.js";import"./index-BOPFo7cB.js";import"./index-D6_L85rf.js";import"./index-Cz02NH1o.js";const ze={class:"flex-c"},Be={class:"flex-c"},Te={class:"flex-c"},Ue={class:"flex"},Ae={class:"flex"},Fe={class:"mr-[10px]"},Oe=we({name:"sqlite",__name:"index",setup(Le){const B=n(!0),c=n(""),E=n([]),b=n(""),W=n([]),H=n([]),K=n(0),F=n(),G=n(!1),J=n(!0),te=t=>{k.value=t?f.value:[],J.value=!1},f=n([]),k=n([]),D=n([]),oe=t=>{k.value.sort((e,d)=>f.value.indexOf(e)-f.value.indexOf(d))},M=(t,e)=>{e?D.value=D.value.filter(d=>d!==t):D.value.push(t)},g=n(""),S=n(),ne=()=>{!S.value.length&&g.value?V("请选择搜索列",{type:"error",customClass:"el"}):(y.value=1,L.value=!L.value)},T=n(),O=n(!1),Q=(t,e)=>{O.value=!1;const d=t==="新增数据"?"add":"edit";le({width:window.innerWidth<992?"90%":"50%",title:t,contentRenderer:()=>ae(qe,{ref:T}),top:"10vh",draggable:!0,props:{data:{columns:f.value,tableInfo:F.value,value:e||f.value.reduce((m,_)=>(m[_]="",m),{}),type:d}},closeCallBack:({options:m,args:_})=>{if((_==null?void 0:_.command)==="sure"){const h=T.value.getData();for(const r in h)h[r]||delete h[r];ke(c.value,b.value,h).then(r=>{r.success?V("操作成功~ Ciallo～(∠・ω< )⌒☆",{type:"success",customClass:"el"}):V(`操作失败: ${r.message}`,{type:"error",customClass:"el"}),U()})}},beforeSure(m,{options:_,index:h}){T.value.getRef().validate(P=>{if(P){const $=T.value.getData();for(const j in $)if($[j]){m();return}if(O.value){m();return}V("真的什么都不填吗?",{type:"warning",customClass:"el"}),O.value=!0}})}})},ue=t=>{ye(c.value,b.value,t).then(e=>{e.success?V("删除成功~ Ciallo～(∠・ω< )⌒☆",{type:"success",customClass:"el"}):V(`删除失败: ${e.message}`,{type:"error",customClass:"el"}),U()})},se=()=>{le({width:window.innerWidth<992?"90%":"50%",title:`自定义sql语句 table: ${b.value}`,contentRenderer:()=>ae(Re),top:"3vh",props:{path:c.value},draggable:!0,hideFooter:!0,closeCallBack:()=>C.value=!C.value})},y=n(1),w=n(20),ce=t=>{w.value=t},re=t=>{y.value=t};ge().then(t=>{E.value=t.data,w.value?c.value=t.data[0]:B.value=!1});const L=n(!1),C=n(!1);A(c,()=>{Ce(c.value).then(t=>{b.value=t.data[0],W.value=t.data,C.value=!C.value,g.value=""})}),A([b,C],([t],[e])=>{t!==e&&(y.value=1),g.value="",U()}),A([w,y,L],()=>{U()}),A(f,t=>k.value=t.filter(e=>!["createdAt","updatedAt"].includes(e)));const U=()=>{B.value=!0;let t="";g.value&&(S.value.forEach(e=>{t+=`${e} LIKE '%${g.value}%' OR `}),t=t.slice(0,-4)),xe(c.value,b.value,y.value,w.value,t).then(e=>{f.value=[],B.value=!1,H.value=e.data,F.value=e.tableInfo,K.value=e.total,f.value=Object.keys(e.tableInfo),g.value||(S.value=[f.value[0]])})};return(t,e)=>{const d=u("el-text"),m=u("el-option"),_=u("el-select"),h=u("el-col"),r=u("el-button"),P=u("el-input"),$=u("el-checkbox"),j=u("el-checkbox-group"),ie=u("el-scrollbar"),de=u("el-popover"),ve=u("el-row"),X=u("el-table-column"),Y=u("el-link"),pe=u("el-popconfirm"),fe=u("el-table"),me=u("el-pagination"),_e=u("el-card"),he=De("loading");return Ve((s(),i(_e,null,{default:a(()=>[o(ve,{gutter:20},{default:a(()=>[o(h,{xs:24,lg:6},{default:a(()=>[x("div",ze,[o(d,{tag:"b",class:"w-[60px]"},{default:a(()=>[p("数据源:")]),_:1}),o(_,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l)},{default:a(()=>[(s(!0),I(R,null,q(E.value,l=>(s(),i(m,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1}),o(h,{xs:24,lg:3},{default:a(()=>[x("div",Be,[o(d,{tag:"b",class:"w-[50px]"},{default:a(()=>[p("表名:")]),_:1}),o(_,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l)},{default:a(()=>[(s(!0),I(R,null,q(W.value,l=>(s(),i(m,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1}),o(h,{xs:24,lg:6},{default:a(()=>[x("div",Te,[o(d,{tag:"b",class:"w-[50px]"},{default:a(()=>[p("搜索:")]),_:1}),o(P,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=l=>g.value=l),placeholder:"支持模糊搜索"},{prepend:a(()=>[o(_,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=l=>S.value=l),placeholder:"搜索列",style:{width:"100px"},multiple:"","collapse-tags":"",clearable:""},{default:a(()=>[(s(!0),I(R,null,q(k.value,l=>(s(),i(m,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),append:a(()=>[o(r,{icon:z(Se),disabled:!c.value,onClick:ne},null,8,["icon","disabled"])]),_:1},8,["modelValue"])])]),_:1}),o(h,{xs:24,lg:1},{default:a(()=>[x("div",Ue,[o(r,{type:"primary",disabled:!c.value,onClick:e[4]||(e[4]=l=>C.value=!C.value)},{default:a(()=>[p("重置")]),_:1},8,["disabled"]),o(r,{type:"success",disabled:!c.value,onClick:e[5]||(e[5]=l=>Q("新增数据"))},{default:a(()=>[p("新增")]),_:1},8,["disabled"]),o(r,{type:"primary",disabled:!c.value,onClick:se},{default:a(()=>[p("sql")]),_:1},8,["disabled"]),o(de,{placement:"bottom",title:"展示列",width:150,trigger:"click"},{reference:a(()=>[o(r,{type:"primary",icon:z($e)},null,8,["icon"])]),default:a(()=>[o(ie,{height:"300px"},{default:a(()=>[o($,{modelValue:G.value,"onUpdate:modelValue":e[6]||(e[6]=l=>G.value=l),indeterminate:J.value,onChange:te},{default:a(()=>[p(" Check all ")]),_:1},8,["modelValue","indeterminate"]),o(j,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=l=>k.value=l),class:"flex flex-col",onChange:oe},{default:a(()=>[(s(!0),I(R,null,q(f.value,l=>(s(),i($,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})])]),_:1})]),_:1}),x("div",null,[o(fe,{ref:"tableRef",data:H.value,height:"65vh",border:"",stripe:"",class:"mb-[20px]"},{default:a(()=>[(s(!0),I(R,null,q(k.value,l=>(s(),i(X,{key:l,prop:l,label:l,"show-overflow-tooltip":{effect:"light"}},{header:a(v=>[x("div",Ae,[F.value[v.column.label].pk?(s(),i(z(N),{key:0,icon:"mdi:primary-key",width:24,height:24,class:"mr-[10px]"})):Z("",!0),x("span",Fe,ee(v.column.label),1),D.value.includes(v.column.label)?(s(),i(z(N),{key:1,icon:"mdi:eye",width:20,height:20,class:"cursor-pointer",onClick:be=>M(v.column.label,!0)},null,8,["onClick"])):(s(),i(z(N),{key:2,icon:"mdi:eye-off",width:20,height:20,class:"cursor-pointer",onClick:be=>M(v.column.label,!1)},null,8,["onClick"]))])]),default:a(v=>[D.value.includes(v.column.label)?(s(),i(d,{key:0},{default:a(()=>[p(" *** ")]),_:1})):(s(),i(d,{key:1},{default:a(()=>[p(ee(v.row[v.column.label]),1)]),_:2},1024))]),_:2},1032,["prop","label"]))),128)),c.value?(s(),i(X,{key:0,fixed:"right",label:"操作",width:"120px"},{default:a(l=>[o(Y,{underline:!1,type:"primary",onClick:v=>Q("修改数据",l.row)},{default:a(()=>[p(" 编辑 ")]),_:2},1032,["onClick"]),o(pe,{title:"确认删除吗？",onConfirm:v=>ue(l.row)},{reference:a(()=>[o(Y,{underline:!1,type:"danger"},{default:a(()=>[p("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})):Z("",!0)]),_:1},8,["data"]),o(me,{"current-page":y.value,"onUpdate:currentPage":e[8]||(e[8]=l=>y.value=l),"page-size":w.value,"onUpdate:pageSize":e[9]||(e[9]=l=>w.value=l),"page-sizes":[5,10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:K.value,class:"flex flex-wrap justify-start",onSizeChange:ce,onCurrentChange:re},null,8,["current-page","page-size","total"])])]),_:1})),[[he,B.value]])}}}),Ge=Ie(Oe,[["__scopeId","data-v-69282291"]]);export{Ge as default};
