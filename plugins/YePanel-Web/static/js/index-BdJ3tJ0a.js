import{f as ge,h as Ce,i as ke,j as ye,k as xe}from"./database-DzSUTjct.js";import{d as we,e as n,H as A,D as Ve,u as i,P as a,A as u,V as Se,i as s,y as o,b as x,B as p,c as I,q,F as U,w as z,aU as De,aC as $e,aP as N,C as Z,x as ee,aG as V,aS as le,k as ae,_ as Ie}from"./index-xwgbA_G8.js";import{_ as qe}from"./add.vue_vue_type_script_setup_true_lang-BYxMFGvg.js";import{_ as Ue}from"./sql.vue_vue_type_script_setup_true_lang-S3kZMK1l.js";import"./index-1tmnVUg0.js";import"./index-BBIzkHyc.js";import"./index-TQ8Vss1d.js";const ze={class:"flex-c"},Re={class:"flex-c"},Be={class:"flex-c"},Te={class:"flex"},Ae={class:"flex"},Pe={class:"mr-[10px]"},Fe=we({name:"sqlite",__name:"index",setup(Le){const R=n(!0),c=n(""),E=n([]),b=n(""),W=n([]),G=n([]),H=n(0),P=n(),K=n(!1),J=n(!0),te=t=>{C.value=t?f.value:[],J.value=!1},f=n([]),C=n([]),S=n([]),oe=t=>{C.value.sort((e,d)=>f.value.indexOf(e)-f.value.indexOf(d))},M=(t,e)=>{e?S.value=S.value.filter(d=>d!==t):S.value.push(t)},g=n(""),D=n(),ne=()=>{!D.value.length&&g.value?V("请选择搜索列",{type:"error",customClass:"el"}):(k.value=1,L.value=!L.value)},B=n(),F=n(!1),Q=(t,e)=>{F.value=!1;const d=t==="新增数据"?"add":"edit";le({width:window.innerWidth<992?"90%":"50%",title:t,contentRenderer:()=>ae(qe,{ref:B}),top:"10vh",draggable:!0,props:{data:{columns:f.value,tableInfo:P.value,value:e||f.value.reduce((m,_)=>(m[_]="",m),{}),type:d}},closeCallBack:({options:m,args:_})=>{if((_==null?void 0:_.command)==="sure"){const h=B.value.getData();for(const r in h)h[r]||delete h[r];Ce(c.value,b.value,h).then(r=>{r.success?V("操作成功~ Ciallo～(∠・ω< )⌒☆",{type:"success",customClass:"el"}):V(`操作失败: ${r.message}`,{type:"error",customClass:"el"}),T()})}},beforeSure(m,{options:_,index:h}){B.value.getRef().validate(O=>{if(O){const $=B.value.getData();for(const j in $)if($[j]){m();return}if(F.value){m();return}V("真的什么都不填吗?",{type:"warning",customClass:"el"}),F.value=!0}})}})},ue=t=>{ke(c.value,b.value,t).then(e=>{e.success?V("删除成功~ Ciallo～(∠・ω< )⌒☆",{type:"success",customClass:"el"}):V(`删除失败: ${e.message}`,{type:"error",customClass:"el"}),T()})},se=()=>{le({width:window.innerWidth<992?"90%":"50%",title:`自定义sql语句 table: ${b.value}`,contentRenderer:()=>ae(Ue),top:"3vh",props:{path:c.value},draggable:!0,hideFooter:!0,closeCallBack:()=>y.value=!y.value})},k=n(1),w=n(20),ce=t=>{w.value=t},re=t=>{k.value=t};ge().then(t=>{E.value=t.data,w.value?c.value=t.data[0]:R.value=!1});const L=n(!1),y=n(!1);A(c,()=>{ye(c.value).then(t=>{b.value=t.data[0],W.value=t.data,y.value=!y.value,g.value=""})}),A([b,y],([t],[e])=>{t!==e&&(k.value=1),g.value="",T()}),A([w,k,L],()=>{T()}),A(f,t=>C.value=t.filter(e=>!["createdAt","updatedAt"].includes(e)));const T=()=>{R.value=!0;let t="";g.value&&(D.value.forEach(e=>{t+=`${e} LIKE '%${g.value}%' OR `}),t=t.slice(0,-4)),xe(c.value,b.value,k.value,w.value,t).then(e=>{f.value=[],R.value=!1,G.value=e.data,P.value=e.tableInfo,H.value=e.total,f.value=Object.keys(e.tableInfo),g.value||(D.value=[f.value[0]])})};return(t,e)=>{const d=u("el-text"),m=u("el-option"),_=u("el-select"),h=u("el-col"),r=u("el-button"),O=u("el-input"),$=u("el-checkbox"),j=u("el-checkbox-group"),ie=u("el-scrollbar"),de=u("el-popover"),ve=u("el-row"),X=u("el-table-column"),Y=u("el-link"),pe=u("el-popconfirm"),fe=u("el-table"),me=u("el-pagination"),_e=u("el-card"),he=Se("loading");return Ve((s(),i(_e,null,{default:a(()=>[o(ve,{gutter:20},{default:a(()=>[o(h,{xs:24,lg:6},{default:a(()=>[x("div",ze,[o(d,{tag:"b",class:"w-[60px]"},{default:a(()=>[p("数据源:")]),_:1}),o(_,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l)},{default:a(()=>[(s(!0),I(U,null,q(E.value,l=>(s(),i(m,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1}),o(h,{xs:24,lg:3},{default:a(()=>[x("div",Re,[o(d,{tag:"b",class:"w-[50px]"},{default:a(()=>[p("表名:")]),_:1}),o(_,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l)},{default:a(()=>[(s(!0),I(U,null,q(W.value,l=>(s(),i(m,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1}),o(h,{xs:24,lg:6},{default:a(()=>[x("div",Be,[o(d,{tag:"b",class:"w-[50px]"},{default:a(()=>[p("搜索:")]),_:1}),o(O,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=l=>g.value=l),placeholder:"支持模糊搜索"},{prepend:a(()=>[o(_,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=l=>D.value=l),placeholder:"搜索列",style:{width:"100px"},multiple:"","collapse-tags":"",clearable:""},{default:a(()=>[(s(!0),I(U,null,q(C.value,l=>(s(),i(m,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),append:a(()=>[o(r,{icon:z(De),disabled:!c.value,onClick:ne},null,8,["icon","disabled"])]),_:1},8,["modelValue"])])]),_:1}),o(h,{xs:24,lg:1},{default:a(()=>[x("div",Te,[o(r,{type:"primary",disabled:!c.value,onClick:e[4]||(e[4]=l=>y.value=!y.value)},{default:a(()=>[p("重置")]),_:1},8,["disabled"]),o(r,{type:"success",disabled:!c.value,onClick:e[5]||(e[5]=l=>Q("新增数据"))},{default:a(()=>[p("新增")]),_:1},8,["disabled"]),o(r,{type:"primary",disabled:!c.value,onClick:se},{default:a(()=>[p("sql")]),_:1},8,["disabled"]),o(de,{placement:"bottom",title:"展示列",width:150,trigger:"click"},{reference:a(()=>[o(r,{type:"primary",icon:z($e)},null,8,["icon"])]),default:a(()=>[o(ie,{height:"300px"},{default:a(()=>[o($,{modelValue:K.value,"onUpdate:modelValue":e[6]||(e[6]=l=>K.value=l),indeterminate:J.value,onChange:te},{default:a(()=>[p(" Check all ")]),_:1},8,["modelValue","indeterminate"]),o(j,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=l=>C.value=l),class:"flex flex-col",onChange:oe},{default:a(()=>[(s(!0),I(U,null,q(f.value,l=>(s(),i($,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})])]),_:1})]),_:1}),x("div",null,[o(fe,{ref:"tableRef",data:G.value,height:"65vh",border:"",stripe:"",class:"mb-[20px]"},{default:a(()=>[(s(!0),I(U,null,q(C.value,l=>(s(),i(X,{key:l,prop:l,label:l,"show-overflow-tooltip":{effect:"light"}},{header:a(v=>[x("div",Ae,[P.value[v.column.label].pk?(s(),i(z(N),{key:0,icon:"mdi:primary-key",width:24,height:24,class:"mr-[10px]"})):Z("",!0),x("span",Pe,ee(v.column.label),1),S.value.includes(v.column.label)?(s(),i(z(N),{key:1,icon:"mdi:eye",width:20,height:20,class:"cursor-pointer",onClick:be=>M(v.column.label,!0)},null,8,["onClick"])):(s(),i(z(N),{key:2,icon:"mdi:eye-off",width:20,height:20,class:"cursor-pointer",onClick:be=>M(v.column.label,!1)},null,8,["onClick"]))])]),default:a(v=>[S.value.includes(v.column.label)?(s(),i(d,{key:0},{default:a(()=>[p(" *** ")]),_:1})):(s(),i(d,{key:1},{default:a(()=>[p(ee(v.row[v.column.label]),1)]),_:2},1024))]),_:2},1032,["prop","label"]))),128)),c.value?(s(),i(X,{key:0,fixed:"right",label:"操作",width:"120px"},{default:a(l=>[o(Y,{underline:!1,type:"primary",onClick:v=>Q("修改数据",l.row)},{default:a(()=>[p(" 编辑 ")]),_:2},1032,["onClick"]),o(pe,{title:"确认删除吗？",onConfirm:v=>ue(l.row)},{reference:a(()=>[o(Y,{underline:!1,type:"danger"},{default:a(()=>[p("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})):Z("",!0)]),_:1},8,["data"]),o(me,{"current-page":k.value,"onUpdate:currentPage":e[8]||(e[8]=l=>k.value=l),"page-size":w.value,"onUpdate:pageSize":e[9]||(e[9]=l=>w.value=l),"page-sizes":[5,10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:H.value,class:"flex flex-wrap justify-start",onSizeChange:ce,onCurrentChange:re},null,8,["current-page","page-size","total"])])]),_:1})),[[he,R.value]])}}}),Ke=Ie(Fe,[["__scopeId","data-v-69282291"]]);export{Ke as default};
