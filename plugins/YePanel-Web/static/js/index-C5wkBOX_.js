import{c as X,i as F}from"./Bot-LR6tov9D.js";import{d as Y,e as v,D as Z,u as f,P as n,A as i,V as ee,i as r,y as o,b as z,B as c,c as B,q as I,F as L,x as C,C as le,w as ae,aQ as te,aR as P,k as N,aS as U,aF as y,_ as ne}from"./index-C1DCms5E.js";import oe from"./options-CnfwbtXb.js";import{_ as se}from"./install.vue_vue_type_script_setup_true_lang-DhvMTNFY.js";import"./home-C_OwIwNx.js";import"./timeline.vue_vue_type_script_setup_true_lang-CsWh4hfQ.js";import"./index-BOPFo7cB.js";const ue={class:"flex-c"},ie={class:"flex-c"},re=Y({name:"bot-plugins",__name:"index",setup(ce){const D=v(!0),g=v(1),h=v(20),$=e=>{h.value=e},j=e=>{g.value=e},_=v("all"),E=[{label:"全部",value:"all"},{label:"已安装",value:"install"},{label:"未安装",value:"uninstall"},{label:"功能插件",value:"function"},{label:"游戏插件",value:"game"},{label:"文游插件",value:"wordgame"}],O=()=>{d.value=""},d=v(""),W=()=>{if(d.value.trim()===""){_.value="all";return}a.value.搜索=a.value.all.filter(e=>e.title.includes(d.value)||e.name.includes(d.value)||e.desc.includes(d.value)||e.authors.some(l=>l.name.includes(d.value))),_.value="搜索"},q=e=>{P({width:window.innerWidth<992?"90%":"50%",title:e.name,top:"5vh",contentRenderer:()=>N(oe),props:{data:{info:e,installed:a.value.install.some(l=>l.name===e.name)},addInstall:w,removeInstall:Q}})},b=v(null),A=()=>{P({width:window.innerWidth<992?"90%":"50%",title:"安装插件",contentRenderer:()=>N(se,{ref:b}),props:{addInstall:w},footerButtons:[{label:"取消",btnClick:({dialog:{options:e,index:l},button:u})=>{U(e,l)}},{label:"确定",type:"primary",loading:!1,btnClick:({dialog:{options:e,index:l},button:u})=>{b.value.getRef().validate(k=>{if(k){u.btn.loading=!0;const s=b.value.getData();F(s.link,s.name,s.branch).then(p=>{u.btn.loading=!1,p.success?(y("安装成功~Ciallo～(∠・ω< )⌒☆",{type:"success",customClass:"el"}),w(s.name||s.link.replace(/\.git$/,"").split("/").pop())):y(p.message,{type:"error",customClass:"el"}),U(e,l)})}})}}],beforeSure(e,{options:l,index:u}){b.value.getRef().validate(k=>{if(k){const s=b.value.getData();F(s.link,s.name,s.branch).then(p=>{p.success?(y("安装成功~Ciallo～(∠・ω< )⌒☆",{type:"success",customClass:"el"}),w(s.name||s.link.replace(/\.git$/,"").split("/").pop())):y(p.message,{type:"error",customClass:"el"}),e()})}})}})},a=v({function:[],game:[],wordgame:[],all:[],install:[],uninstall:[],搜索:[]}),w=e=>{const l=a.value.uninstall.findIndex(u=>u.name.toLowerCase()===e.toLowerCase());l!==-1?(a.value.install.push(a.value.uninstall[l]),a.value.uninstall.splice(l,1)):a.value.install.push({name:e,title:e,link:"",authors:[],desc:""})},Q=e=>{const l=a.value.install.findIndex(u=>u.name.toLowerCase()===e.toLowerCase());l!==-1&&(a.value.uninstall.push(a.value.install[l]),a.value.install.splice(l,1))};return X().then(e=>{a.value.function=[...e.data.main,...e.data.function],a.value.game=e.data.game,a.value.wordgame=e.data.wordgame,a.value.all=[...a.value.function,...a.value.game,...a.value.wordgame],a.value.uninstall=[...a.value.all],e.data.install.forEach(w),a.value.all.push(...a.value.install.filter(l=>!l.link)),D.value=!1}),(e,l)=>{const u=i("el-text"),R=i("el-option"),k=i("el-select"),s=i("el-col"),p=i("el-input"),S=i("el-button"),T=i("el-row"),V=i("el-link"),G=i("el-tag"),x=i("el-table-column"),H=i("el-table"),J=i("el-pagination"),K=i("el-card"),M=ee("loading");return Z((r(),f(K,null,{default:n(()=>[o(T,{gutter:20},{default:n(()=>[o(s,{xs:12,lg:4,sm:12},{default:n(()=>[z("div",ue,[o(u,{tag:"b",class:"w-[70px]"},{default:n(()=>[c("数据源:")]),_:1}),o(k,{modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=t=>_.value=t),onChange:O},{default:n(()=>[(r(),B(L,null,I(E,t=>o(R,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])]),_:1}),o(s,{xs:12,lg:4,sm:12},{default:n(()=>[z("div",ie,[o(u,{tag:"b",class:"w-[60px]"},{default:n(()=>[c("搜索:")]),_:1}),o(p,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=t=>d.value=t),placeholder:"Ciallo～(∠・ω< )⌒☆",onInput:W},null,8,["modelValue"])])]),_:1}),o(s,{xs:12,lg:4,sm:12},{default:n(()=>[o(S,{type:"primary",onClick:A},{default:n(()=>[c("安装自定义插件")]),_:1})]),_:1})]),_:1}),z("div",null,[o(H,{ref:"tableRef",data:a.value[_.value].slice((g.value-1)*h.value,g.value*h.value),height:"65vh",stripe:"",class:"mb-[20px]"},{default:n(()=>[o(x,{label:"标题",prop:"title",width:"200px"},{default:n(t=>[t.row.link?(r(),f(V,{key:0,underline:!1,href:t.row.link,target:"_blank",type:"primary"},{default:n(()=>[c(C(t.row.title),1)]),_:2},1032,["href"])):(r(),f(u,{key:1},{default:n(()=>[c(C(t.row.title),1)]),_:2},1024)),a.value.install.some(m=>m.name===t.row.name)?(r(),f(G,{key:2,type:"success",size:"small"},{default:n(()=>[c("已安装")]),_:1})):le("",!0)]),_:1}),o(x,{label:"名称",prop:"name",width:"200px"},{default:n(t=>[t.row.link?(r(),f(V,{key:0,underline:!1,href:t.row.link,target:"_blank",type:"primary"},{default:n(()=>[c(C(t.row.name),1)]),_:2},1032,["href"])):(r(),f(u,{key:1},{default:n(()=>[c(C(t.row.name),1)]),_:2},1024))]),_:1}),o(x,{label:"作者",prop:"authors",width:"200px"},{default:n(t=>[(r(!0),B(L,null,I(t.row.authors,m=>(r(),f(V,{key:m.link,underline:!1,href:m.link,target:"_blank",type:m.link?"primary":"default"},{default:n(()=>[c(C(m.name),1)]),_:2},1032,["href","type"]))),128))]),_:1}),o(x,{label:"描述",prop:"desc"}),o(x,{fixed:"right",label:"操作",width:"120px"},{default:n(t=>[o(S,{icon:ae(te),circle:"",size:"small",onClick:m=>q(t.row)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"]),o(J,{"current-page":g.value,"onUpdate:currentPage":l[2]||(l[2]=t=>g.value=t),"page-size":h.value,"onUpdate:pageSize":l[3]||(l[3]=t=>h.value=t),"page-sizes":[5,10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:a.value[_.value].length,class:"flex flex-wrap justify-start",onSizeChange:$,onCurrentChange:j},null,8,["current-page","page-size","total"])])]),_:1})),[[M,D.value]])}}}),he=ne(re,[["__scopeId","data-v-91c852e7"]]);export{he as default};
