import{d as V,e as l,o as k,ao as N,u as E,P as p,A as c,i as O,y as r,B as A,b2 as B,b as I,w as J,aE as K}from"./index-C1DCms5E.js";import{_ as T,T as D}from"./vue-web-terminal-B1MEMTR6.js";const L={class:"h-[70vh]"},j=V({name:"terminal",__name:"index",setup(U){const b=[{type:"normal",content:"Terminal Initializing ..."}],m=l(15),S=t=>m.value=t,n=l(),v=l(""),x=l(!1),a=l(null),u=l(),f=l(),C=(t,o,d,_,h)=>{if(o==="Ciallo～(∠・ω< )⌒☆"&&!x.value)n.value.pushMessage({type:"normal",content:"Authentication in progress..."}),a.value=K("terminal",{onmessage:s=>{try{const e=JSON.parse(s.data);e.type==="output"?n.value.pushMessage({type:"normal",content:e.content}):e.type==="error"?n.value.pushMessage({type:"normal",content:e.content,class:"error",tag:"error"}):e.type==="directory"?v.value=e.content:e.type==="close"&&u.value.finish()}catch(e){n.value.pushMessage({type:"table",content:e,class:"error",tag:"error"}),u.value.finish();return}},onopen:()=>{x.value=!0,n.value.pushMessage({type:"normal",content:"Authentication successful.",class:"success"}),n.value.pushMessage({type:"normal",content:"tip: 不可以实现SSH客户端, 不能处理tsab、vim等带有其他键盘、鼠标、窗口行为的 ANSI 控制码的指令",class:"info"}),d(),f.value=setInterval(()=>{a.value.send(JSON.stringify({time:Math.floor(Date.now()/1e3),action:"ping"}))},3e4)},onerror:s=>{n.value.pushMessage({type:"table",content:s,class:"error",tag:"error"}),u.value.finish(),a.value=null},onclose:s=>{clearInterval(f.value),f.value=null,n.value.pushMessage({type:"normal",content:"终端已关闭！",class:"error",tag:"error"}),u.value.finish(),a.value=null}});else{const e=o.split(" ").slice(1),y={action:"execute",command:t,args:e,workingDirectory:v.value};a.value.readyState===1?(a.value.send(JSON.stringify(y)),u.value=new D,d(u.value)):_("终端连接异常！")}},w=t=>{t.ctrlKey&&t.keyCode===67&&(t.preventDefault(),a.value&&a.value.send(JSON.stringify({action:"terminate"})))},i=l(""),M=t=>{i.value&&(n.value.execute(i.value),i.value="")};return k(()=>{n.value.execute("Ciallo～(∠・ω< )⌒☆"),window.addEventListener("keydown",w)}),N(()=>{a.value&&a.value.close(),window.removeEventListener("keydown",w)}),(t,o)=>{const d=c("el-text"),_=c("el-input-number"),h=c("el-col"),s=c("el-input"),e=c("el-row"),y=c("el-card");return O(),E(y,null,{default:p(()=>[r(e,null,{default:p(()=>[r(h,{xs:24,md:6,lg:5,xl:3,class:"mb-[10px]"},{default:p(()=>[r(d,null,{default:p(()=>[A("行高")]),_:1}),r(_,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=g=>m.value=g),class:"ml-[10px]",min:1,max:100,onChange:S},null,8,["modelValue"])]),_:1}),r(h,{xs:24,md:18,lg:19,xl:21,class:"mb-[10px]"},{default:p(()=>[r(s,{modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=g=>i.value=g),placeholder:"若终端输入有异常可在此输入命令",onKeydown:B(M,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),I("div",L,[r(J(T),{ref_key:"terminalRef",ref:n,name:"terminal",context:v.value,"init-log":b,"show-header":!1,"line-space":m.value,"enable-default-command":!1,onExecCmd:C},null,8,["context","line-space"])])]),_:1})}}});export{j as default};
