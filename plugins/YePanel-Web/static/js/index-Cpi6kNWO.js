import{d as U,e as n,o as D,ao as I,u as b,P as i,A as p,i as d,b as _,y as m,B as g,c as J,q as P,w as L,F as W,aE as q}from"./index-C1DCms5E.js";import{_ as G,T as H}from"./vue-web-terminal-B1MEMTR6.js";import{C as K}from"./ansi_to_html-4-BCAPBq.js";const z={class:"flex flex-wrap"},Q={class:"mb-[10px]"},X={class:"mb-[10px]"},Y={class:"mb-[10px]"},Z={class:"h-[70vh]"},ne=U({name:"realtimeLog",__name:"index",setup(ee){const N=new K,k={tarce:"#999999",debug:"#00aaff",info:"#00cc00",mark:"#999999",warn:"#ffaa00",error:"#ff0000",fatal:"#990000"},R={trace:"TRCE",debug:"DBUG",info:"INFO",warn:"WARN",error:"ERRR",fatal:"FATL",mark:"MARK"},O=Object.keys(k).reduce((e,a)=>(e[a]=Object.keys(k).indexOf(a),e),{}),w=n(2),h=n(10),B=e=>h.value=e,l=n(),S=n(""),V=n(!1),r=n(null),f=n(),T=()=>{l.value.clearLog()},y=n(!1),C=n([]),j=()=>{y.value=!0},E=()=>{for(y.value=!1;C.value.length;)l.value.pushMessage(C.value.shift())},$=e=>{if(Array.isArray(e))return"[ "+e.map($).join(" ")+" ]";if(typeof e=="object")try{return`{${Object.entries(e).map(([a,c])=>{const v=typeof c=="string"?`'${c}'`:c;return` ${a}: ${v} `}).join(", ")}}`}catch{return String(e)}return e},M=n(null),F=(e,a,c,v,A)=>{if(a==="Ciallo～(∠・ω< )⌒☆"&&!V.value)l.value.pushMessage({type:"normal",content:"Authentication in progress..."}),r.value=q("realtimeLog",{onmessage:u=>{try{const t=JSON.parse(u.data);if(t.type==="logger"&&w.value<=O[t.level]){const s={type:"html",content:`<span style="color:${k[t.level]}">[${t.timestamp}][${R[t.level]}]</span>${t.logs.map(o=>typeof o=="string"?(o=N.toHtml(o).replace(/#00A/g,"#4169e1"),o):$(o)).join(" ").replace(/\n|\r/g,"<br>").replace(new RegExp("(?<=^|>)([^<]*?)(?=<|$)","g"),o=>o.replace(/ /g,"&nbsp;"))}`};y.value?C.value.push(s):l.value.pushMessage(s)}}catch(t){l.value.pushMessage({type:"table",content:t,class:"error",tag:"error"}),f.value.finish();return}},onopen:()=>{V.value=!0,l.value.pushMessage({type:"normal",content:"Authentication successful.",class:"success"}),M.value=setInterval(()=>{r.value.send(JSON.stringify({time:Math.floor(Date.now()/1e3),action:"ping"}))},3e4)},onerror:u=>{l.value.pushMessage({type:"table",content:u,class:"error",tag:"error"}),f.value.finish(),r.value=null},onclose:u=>{l.value.pushMessage({type:"normal",content:"终端已关闭！",class:"error",tag:"error"}),f.value.finish(),r.value=null,clearInterval(M.value),M.value=null}});else{const t=a.split(" ").slice(1),x={action:"execute",command:e,args:t,workingDirectory:S.value};r.value.readyState===1?(r.value.send(JSON.stringify(x)),f.value=new H,c(f.value)):v("终端连接异常！")}};return D(()=>{l.value.execute("Ciallo～(∠・ω< )⌒☆")}),I(()=>{r.value&&r.value.close()}),(e,a)=>{const c=p("el-text"),v=p("el-input-number"),A=p("el-option"),u=p("el-select"),t=p("el-button"),x=p("el-card");return d(),b(x,null,{default:i(()=>[_("div",z,[_("div",Q,[m(c,null,{default:i(()=>[g("行高: ")]),_:1}),m(v,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=s=>h.value=s),class:"mx-[10px]",min:1,max:100,onChange:B},null,8,["modelValue"])]),_("div",X,[m(c,{class:"w-[70px]"},{default:i(()=>[g(" 日志等级: ")]),_:1}),m(u,{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=s=>w.value=s),style:{width:"150px"},class:"mr-[10px]"},{default:i(()=>[(d(!0),J(W,null,P(Object.keys(L(O)),(s,o)=>(d(),b(A,{key:s,label:s,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_("div",Y,[m(t,{type:"danger",onClick:T},{default:i(()=>[g(" 清空 ")]),_:1}),y.value?(d(),b(t,{key:1,type:"success",onClick:E},{default:i(()=>[g(" 继续 ")]),_:1})):(d(),b(t,{key:0,type:"primary",onClick:j},{default:i(()=>[g(" 暂停 ")]),_:1}))])]),_("div",Z,[m(L(G),{ref_key:"terminalRef",ref:l,name:"terminal",context:S.value,"enable-fold":!1,"line-space":h.value,"show-header":!1,"enable-default-command":!1,onExecCmd:F},null,8,["context","line-space"])])]),_:1})}}});export{ne as default};
