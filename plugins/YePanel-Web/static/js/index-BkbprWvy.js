import{g as he,d as W,a as _e,m as ge,r as Ce,s as xe}from"./system-9ARTRrZR.js";import{_ as ke}from"./svg.vue_vue_type_script_setup_true_lang-CL0J0BVw.js";import{d as ye,e as d,u as S,P as l,aF as p,A as v,i as g,y as s,c as H,q as be,B as c,x as le,F as we,w as V,aO as X,b6 as De,aZ as $e,aX as Se,b as R,C as L,v as Re,b7 as Be,l as Ie,ae as je,af as Fe,aR as Ve,k as ze,_ as Ee}from"./index-C1DCms5E.js";import{_ as Ae}from"./dialog.vue_vue_type_script_setup_true_lang-B4Dew9nQ.js";import"./index-D6_L85rf.js";const ae=T=>(je("data-v-4cc1cf0f"),T=T(),Fe(),T),Te=ae(()=>R("div",null,"拖动文件到此处或点我上传",-1)),Ue=ae(()=>R("div",{class:"text-center"},[c(" 仅支持简单文件上传，请勿上传大文件"),R("br"),c("上传同名文件将会覆盖原文件。 ")],-1)),Le={class:"text-right"},Oe={class:"flex items-center"},Pe={class:"mr-[10px]"},Me={key:0},Ne={key:0},Ze=ye({name:"files",__name:"index",setup(T){const se=d(window.innerWidth<=768?62:window.innerWidth<=1200?66:70),m=d([]),_=d(""),B=d([]),O=d(),x=d([]),k=d(),U=d(!1),ne=t=>t.name!=="..",oe=t=>{x.value=t,x.value.length||(k.value=null)},ie=({prop:t,order:e})=>{let n=null;m.value[0].name===".."&&(n=m.value.shift());const a=[],o=[];m.value.forEach(r=>{r.isDir?a.push(r):o.push(r)});const u=r=>/^[^a-zA-Z\u4e00-\u9fa5]/.test(r),w=r=>/^[a-zA-Z]/.test(r),D=(r,f,y)=>{const $=u(r.name),h=u(f.name),j=w(r.name),F=w(f.name);if(y==="descending"){if(!$&&h)return-1;if($&&!h)return 1;if(!j&&F)return-1;if(j&&!F)return 1}else{if($&&!h)return-1;if(!$&&h)return 1;if(j&&!F)return-1;if(!j&&F)return 1}return r.name.localeCompare(f.name)*(y==="descending"?-1:1)},I=(r,f,y)=>{r.sort(($,h)=>y==="descending"?h[f]-$[f]:$[f]-h[f])};switch(t){case"name":a.sort((r,f)=>D(r,f,e)),o.sort((r,f)=>D(r,f,e));break;case"size":I(a,"rowSize",e),I(o,"rowSize",e);break;case"time":I(a,"mtimeMs",e),I(o,"mtimeMs",e);break}e==="descending"?m.value=[...o,...a]:m.value=[...a,...o],n&&m.value.unshift(n)},P=()=>{k.value=null,x.value=[],O.value.clearSelection()},ue=t=>new Promise((e,n)=>{const a=new FileReader;a.onloadend=()=>{e(a.result)},a.onerror=n,a.readAsText(t)}),G=d(),J=t=>{Ve({width:"80%",top:"5vh",contentRenderer:()=>ze(Ae,{ref:G}),props:t.props,closeCallBack:t.closeCallBack})},K=t=>{if(t.isDir)B.value.length>=10&&B.value.pop(),B.value.unshift(_.value),b(t.path);else{const e=["jpg","jpeg","png","gif","ico","svg","webp","bmp"],n=["html","htm","css","less","sass","js","json","xml","vue","yaml","yml","md","cjs","mjs","ts","jsx","tsx","php","java","cpp","rs","erl","scm","go","lua","pas","pl","sql","styl","swift","tcl","toml","sh","gitignore","npmrc","erl","bat","bf","clj","coffee","ps1","txt","r","rb","py","ini","jl","vb","vbs"],a={type:null,data:{}};if(e.includes(t.ext))W(t.path,t.name).then(o=>{const u=URL.createObjectURL(o);a.type="image",a.data={url:u},J({props:a})});else if(n.includes(t.ext))W(t.path,t.name).then(o=>ue(o)).then(o=>{a.type="code",a.data={ext:t.ext,content:o},J({props:a,closeCallBack({options:u,args:w}){(w==null?void 0:w.command)==="sure"&&xe(t.path,G.value.getData().content).then(D=>{D.success?p("保存成功~ Ciallo～(∠・ω< )⌒☆",{customClass:"el",type:"success"}):p("保存失败:"+D.message,{customClass:"el",type:"error"})})}})});else return p("暂不支持预览该文件类型",{customClass:"el",type:"warning"})}},Q=d(""),ce=t=>{let e=0,n=0;t.forEach(o=>{o.isDir?n++:e++});const a=["确认删除"];e&&a.push(`${e}个文件`),n&&(e&&a.push("和"),a.push(`${n}个文件夹`)),a.push("吗？"),Q.value=a.join("")},Y=t=>{_e(t.map(e=>({path:e.path,isDir:e.isDir}))).then(e=>{var n;if(P(),!e.success){p("操作失败:"+e.message,{customClass:"el",type:"error"});return}if((n=e.errors)!=null&&n.length)for(const{path:a,isDir:o,message:u}of e.errors)p((o?"文件夹":"文件")+`“${a}”删除失败:`+u,{customClass:"el",type:"error"});p("删除成功~ Ciallo～(∠・ω< )⌒☆",{customClass:"el",type:"success"}),b(_.value)})},re=t=>{W(t.path,t.name).then(e=>{Be(e,t.name)}).catch(e=>{p("下载失败:"+e.message,{customClass:"el",type:"error"})})},M=d(!1),N=d(),Z=d([]),de=()=>{N.value.submit(),M.value=!0},me=t=>{const e=Z.value.indexOf(t.data.name);e!==-1&&Z.value.splice(e,1),t.success||p(t.data.name+"上传失败:"+t.message,{customClass:"el",type:"error"}),Z.value.length===0&&(N.value.clearFiles(),M.value=!1,U.value=!1,b(_.value),p("上传成功~ Ciallo～(∠・ω< )⌒☆",{customClass:"el",type:"success"}))},pe=t=>{var o;if((o=C.value)!=null&&o.path){q.value.focus();return}let e=m.value.findIndex(u=>(t==="file"?!u.isDir:u.isDir)&&u.name!=="..");e===-1&&(t==="dir"?e=1:e=m.value.length);let n="新建文件"+(t==="file"?".txt":"夹"),a=1;for(;m.value.some(u=>u.name===n);){n="新建文件"+(t==="file"?`（${a}）.txt`:`夹（${a}）`);a++}m.value.splice(e,0,{name:n,path:`${_.value}/${n}`,ext:t==="file"?"file":"folder",size:"",rowSize:0,time:"",mtimeMs:0,isDir:t==="dir"}),ee(m.value[e])},fe=()=>{ge(x.value.map(t=>({path:t.path,name:t.name,isDir:t.isDir})),_.value,k.value).then(t=>{var e;if(P(),!t.success){p("操作失败:"+t.message,{customClass:"el",type:"error"});return}if((e=t.errors)!=null&&e.length)for(const{path:n,isDir:a,message:o}of t.errors)p((a?"文件夹":"文件")+`“${n}” ${k.value}失败 ${o}`,{customClass:"el",type:"error"});p(`${k.value}}成功~ Ciallo～(∠・ω< )⌒☆`,{customClass:"el",type:"success"}),b(_.value)})},z=d(),C=d(),q=d(),ee=t=>{C.value=t,z.value=t.name,Ie(()=>{q.value.focus()})},ve=()=>{Ce(C.value.path,z.value,C.value.isDir).then(t=>{const e=(C.value.mtimeMs===0?"创建":"重命名")+(C.value.isDir?"文件夹":"文件");if(te(),!t.success){p(`${e}成功失败...${t.message}`,{customClass:"el",type:"error"});return}p(`${e}成功~ Ciallo～(∠・ω< )⌒☆`,{customClass:"el",type:"success"}),b(_.value)})},te=()=>{C.value.mtimeMs===0&&m.value.splice(m.value.indexOf(C.value),1),C.value={},z.value=""},b=t=>{he(t).then(e=>{if(!e.success){p(e.message,{customClass:"el",type:"error"});return}_.value=e.data.path;const n=[];e.data.parentPath&&n.push({name:"..",path:e.data.parentPath,ext:"folder",size:"",time:"",isDir:!0});const a=[];e.data.files.forEach(o=>{o.isDir?n.push(o):a.push(o)}),m.value=[...n,...a],O.value.setScrollTop(0)})};return b(""),(t,e)=>{const n=v("el-dropdown-item"),a=v("el-dropdown-menu"),o=v("el-dropdown"),u=v("el-button"),w=v("el-input"),D=v("el-col"),I=v("el-popover"),r=v("el-popconfirm"),f=v("el-row"),y=v("el-table-column"),$=v("el-text"),h=v("el-link"),j=v("el-table"),F=v("el-card");return g(),S(F,{class:"h-[80vh]"},{default:l(()=>[s(f,{class:"flex flex-wrap"},{default:l(()=>[s(D,{xl:7,sm:12,lg:7,xs:24,class:"mr-[10px]"},{default:l(()=>[s(w,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=i=>_.value=i)},{prepend:l(()=>[s(o,{"split-button":"",disabled:!B.value.length,onCommand:b,onClick:e[0]||(e[0]=i=>b(B.value.shift()))},{dropdown:l(()=>[s(a,null,{default:l(()=>[(g(!0),H(we,null,be(B.value,i=>(g(),S(n,{key:i,command:i},{default:l(()=>[c(le(i),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:l(()=>[s(V(X),{icon:"mdi:arrow-left"})]),_:1},8,["disabled"])]),append:l(()=>[s(u,{onClick:e[1]||(e[1]=i=>b(_.value))},{default:l(()=>[s(V(X),{icon:"mdi:arrow-right"})]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(D,{xl:3,sm:12,lg:3,xs:24,class:"mr-[10px]"},{default:l(()=>[s(I,{width:400,trigger:"click",visible:U.value},{reference:l(()=>[s(u,{type:"primary",class:"mr-[10px]",onClick:e[3]||(e[3]=i=>U.value=!0)},{default:l(()=>[c("上传")]),_:1})]),default:l(()=>[s(V(De),{ref_key:"uploadRef",ref:N,drag:"",action:`${V($e)()}/upload-file`,multiple:"",data:{path:_.value},"show-file-list":"","auto-upload":!1,headers:{Authorization:`Bearer ${V(Se)().accessToken}`},"on-success":me},{tip:l(()=>[Ue,R("div",Le,[s(u,{text:"",onClick:e[4]||(e[4]=i=>U.value=!1)},{default:l(()=>[c("取消")]),_:1}),s(u,{type:"primary",loading:M.value,onClick:de},{default:l(()=>[c(" 确认 ")]),_:1},8,["loading"])])]),default:l(()=>[R("div",null,[s(V(X),{icon:"mdi:upload",width:96,class:"m-auto"})]),Te]),_:1},8,["action","data","headers"])]),_:1},8,["visible"]),s(o,{trigger:"click",onCommand:pe},{dropdown:l(()=>[s(a,null,{default:l(()=>[s(n,{command:"file"},{default:l(()=>[c(" 文件 ")]),_:1}),s(n,{command:"dir"},{default:l(()=>[c(" 文件夹 ")]),_:1})]),_:1})]),default:l(()=>[s(u,{type:"primary",class:"mr-[10px]"},{default:l(()=>[c("新建")]),_:1})]),_:1}),s(r,{title:Q.value,width:"300px",onConfirm:e[6]||(e[6]=i=>Y(x.value))},{reference:l(()=>[s(u,{type:"danger",disabled:!x.value.length,onClick:e[5]||(e[5]=i=>ce(x.value))},{default:l(()=>[c("删除")]),_:1},8,["disabled"])]),_:1},8,["title"])]),_:1}),s(D,{xl:6,sm:12,lg:6,xs:24},{default:l(()=>[s(u,{type:"primary",disabled:!x.value.length||k.value=="copy",onClick:e[7]||(e[7]=i=>k.value="copy")},{default:l(()=>[c("复制")]),_:1},8,["disabled"]),s(u,{type:"primary",disabled:!x.value.length||k.value=="move",onClick:e[8]||(e[8]=i=>k.value="move")},{default:l(()=>[c("移动")]),_:1},8,["disabled"]),x.value.length?(g(),S(u,{key:0,type:"default",onClick:P},{default:l(()=>[c("取消")]),_:1})):L("",!0),k.value?(g(),S(u,{key:1,type:"success",onClick:fe},{default:l(()=>[c("粘贴")]),_:1})):L("",!0)]),_:1})]),_:1}),R("div",null,[s(j,{ref_key:"tableRef",ref:O,data:m.value,"row-key":"path",height:`${se.value}vh`,onCellDblclick:K,onSelectionChange:oe,onSortChange:ie},{default:l(()=>[s(y,{type:"selection",selectable:ne,"reserve-selection":""}),c('" '),s(y,{label:"名称",sortable:"'custom'",prop:"name"},{default:l(i=>{var E;return[R("div",Oe,[R("div",Pe,[(g(),S(Re(ke),{name:i.row.ext},null,8,["name"]))]),((E=C.value)==null?void 0:E.path)===i.row.path?(g(),S(w,{key:0,ref_key:"renameInputRef",ref:q,modelValue:z.value,"onUpdate:modelValue":e[9]||(e[9]=A=>z.value=A)},{append:l(()=>[s(u,{onClick:ve},{default:l(()=>[c("确认")]),_:1})]),_:1},8,["modelValue"])):(g(),S($,{key:1},{default:l(()=>[c(le(i.row.name),1)]),_:2},1024))])]}),_:1}),s(y,{label:"大小",prop:"size",sortable:"'custom'"}),s(y,{label:"修改时间",prop:"time",sortable:"'custom'"}),s(y,{label:"操作"},{default:l(i=>{var E;return[((E=C.value)==null?void 0:E.path)!==i.row.path?(g(),H("span",Me,[s(h,{underline:!1,onClick:A=>K(i.row)},{default:l(()=>[c("打开")]),_:2},1032,["onClick"]),i.row.name!==".."?(g(),H("span",Ne,[s(h,{underline:!1,onClick:A=>ee(i.row)},{default:l(()=>[c("重命名")]),_:2},1032,["onClick"]),i.row.isDir?L("",!0):(g(),S(h,{key:0,underline:!1,onClick:A=>re(i.row)},{default:l(()=>[c("下载")]),_:2},1032,["onClick"])),s(r,{title:i.row.isDir?"确认删除这个文件夹吗？":"确认删除这个文件吗？",width:"200px",onConfirm:A=>Y([i.row])},{reference:l(()=>[s(h,{underline:!1,type:"danger"},{default:l(()=>[c("删除")]),_:1})]),_:2},1032,["title","onConfirm"])])):L("",!0)])):(g(),S(h,{key:1,onClick:te},{default:l(()=>[c("取消")]),_:1}))]}),_:1})]),_:1},8,["data","height"])])]),_:1})}}}),Je=Ee(Ze,[["__scopeId","data-v-4cc1cf0f"]]);export{Je as default};
