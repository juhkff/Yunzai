import{g as he,d as Z,a as _e,m as ge,r as Ce,s as ye}from"./system-DKBxj9qj.js";import{_ as ke}from"./svg.vue_vue_type_script_setup_true_lang-Cls3WrtF.js";import{d as xe,e as d,u as $,P as l,aG as m,A as v,i as g,y as s,c as G,q as be,B as c,x as le,F as we,w as V,aP as H,b as S,b7 as De,a_ as $e,aY as Se,C as P,v as Re,b8 as Be,l as Ie,ae as je,af as Fe,aS as Ve,k as ze,_ as Ee}from"./index-xwgbA_G8.js";import{_ as Ae}from"./dialog.vue_vue_type_script_setup_true_lang-Bh32CS1J.js";import"./index-BBIzkHyc.js";const ae=T=>(je("data-v-87883755"),T=T(),Fe(),T),Te={class:"mr-[10px] div-col"},Ue=ae(()=>S("div",null,"拖动文件到此处或点我上传",-1)),Pe=ae(()=>S("div",{class:"text-center"},[c(" 仅支持简单文件上传，请勿上传大文件"),S("br"),c("上传同名文件将会覆盖原文件。 ")],-1)),Le={class:"text-right"},Me={class:"flex items-center"},Oe={class:"mr-[10px]"},Ne={key:0},qe={key:0},We=xe({name:"files",__name:"index",setup(T){const se=d(window.innerWidth<=768?62:window.innerWidth<=1200?66:70),p=d([]),_=d(""),B=d([]),L=d(),y=d([]),k=d(),U=d(!1),ne=t=>t.name!=="..",oe=t=>{y.value=t,y.value.length||(k.value=null)},ie=({prop:t,order:e})=>{let n=null;p.value[0].name===".."&&(n=p.value.shift());const a=[],o=[];p.value.forEach(r=>{r.isDir?a.push(r):o.push(r)});const u=r=>/^[^a-zA-Z\u4e00-\u9fa5]/.test(r),w=r=>/^[a-zA-Z]/.test(r),R=(r,f,x)=>{const D=u(r.name),h=u(f.name),j=w(r.name),F=w(f.name);if(x==="descending"){if(!D&&h)return-1;if(D&&!h)return 1;if(!j&&F)return-1;if(j&&!F)return 1}else{if(D&&!h)return-1;if(!D&&h)return 1;if(j&&!F)return-1;if(!j&&F)return 1}return r.name.localeCompare(f.name)*(x==="descending"?-1:1)},I=(r,f,x)=>{r.sort((D,h)=>x==="descending"?h[f]-D[f]:D[f]-h[f])};switch(t){case"name":a.sort((r,f)=>R(r,f,e)),o.sort((r,f)=>R(r,f,e));break;case"size":I(a,"rowSize",e),I(o,"rowSize",e);break;case"time":I(a,"mtimeMs",e),I(o,"mtimeMs",e);break}e==="descending"?p.value=[...o,...a]:p.value=[...a,...o],n&&p.value.unshift(n)},M=()=>{k.value=null,y.value=[],L.value.clearSelection()},ue=t=>new Promise((e,n)=>{const a=new FileReader;a.onloadend=()=>{e(a.result)},a.onerror=n,a.readAsText(t)}),Y=d(),J=t=>{Ve({width:"80%",top:"5vh",contentRenderer:()=>ze(Ae,{ref:Y}),props:t.props,closeCallBack:t.closeCallBack})},K=t=>{if(t.isDir)B.value.length>=10&&B.value.pop(),B.value.unshift(_.value),b(t.path);else{const e=["jpg","jpeg","png","gif","ico","svg","webp","bmp"],n=["html","htm","css","less","sass","js","json","xml","vue","yaml","yml","md","cjs","mjs","ts","jsx","tsx","php","java","cpp","rs","erl","scm","go","lua","pas","pl","sql","styl","swift","tcl","toml","sh","gitignore","npmrc","erl","bat","bf","clj","coffee","ps1","txt","r","rb","py","ini","jl","vb","vbs"],a={type:null,data:{}};if(e.includes(t.ext))Z(t.path,t.name).then(o=>{const u=URL.createObjectURL(o);a.type="image",a.data={url:u},J({props:a})});else if(n.includes(t.ext))Z(t.path,t.name).then(o=>ue(o)).then(o=>{a.type="code",a.data={ext:t.ext,content:o},J({props:a,closeCallBack({options:u,args:w}){(w==null?void 0:w.command)==="sure"&&ye(t.path,Y.value.getData().content).then(R=>{R.success?m("保存成功~ Ciallo～(∠・ω< )⌒☆",{customClass:"el",type:"success"}):m("保存失败:"+R.message,{customClass:"el",type:"error"})})}})});else return m("暂不支持预览该文件类型",{customClass:"el",type:"warning"})}},Q=d(""),ce=t=>{let e=0,n=0;t.forEach(o=>{o.isDir?n++:e++});const a=["确认删除"];e&&a.push(`${e}个文件`),n&&(e&&a.push("和"),a.push(`${n}个文件夹`)),a.push("吗？"),Q.value=a.join("")},X=t=>{_e(t.map(e=>({path:e.path,isDir:e.isDir}))).then(e=>{var n;if(M(),!e.success){m("操作失败:"+e.message,{customClass:"el",type:"error"});return}if((n=e.errors)!=null&&n.length)for(const{path:a,isDir:o,message:u}of e.errors)m((o?"文件夹":"文件")+`“${a}”删除失败:`+u,{customClass:"el",type:"error"});m("删除成功~ Ciallo～(∠・ω< )⌒☆",{customClass:"el",type:"success"}),b(_.value)})},re=t=>{Z(t.path,t.name).then(e=>{Be(e,t.name)}).catch(e=>{m("下载失败:"+e.message,{customClass:"el",type:"error"})})},O=d(!1),N=d(),q=d([]),de=()=>{N.value.submit(),O.value=!0},pe=t=>{const e=q.value.indexOf(t.data.name);e!==-1&&q.value.splice(e,1),t.success||m(t.data.name+"上传失败:"+t.message,{customClass:"el",type:"error"}),q.value.length===0&&(N.value.clearFiles(),O.value=!1,U.value=!1,b(_.value),m("上传成功~ Ciallo～(∠・ω< )⌒☆",{customClass:"el",type:"success"}))},me=t=>{var o;if((o=C.value)!=null&&o.path){W.value.focus();return}let e=p.value.findIndex(u=>(t==="file"?!u.isDir:u.isDir)&&u.name!=="..");e===-1&&(t==="dir"?e=1:e=p.value.length);let n="新建文件"+(t==="file"?".txt":"夹"),a=1;for(;p.value.some(u=>u.name===n);){n="新建文件"+(t==="file"?`（${a}）.txt`:`夹（${a}）`);a++}p.value.splice(e,0,{name:n,path:`${_.value}/${n}`,ext:t==="file"?"file":"folder",size:"",rowSize:0,time:"",mtimeMs:0,isDir:t==="dir"}),ee(p.value[e])},fe=()=>{ge(y.value.map(t=>({path:t.path,name:t.name,isDir:t.isDir})),_.value,k.value).then(t=>{var e;if(M(),!t.success){m("操作失败:"+t.message,{customClass:"el",type:"error"});return}if((e=t.errors)!=null&&e.length)for(const{path:n,isDir:a,message:o}of t.errors)m((a?"文件夹":"文件")+`“${n}” ${k.value}失败 ${o}`,{customClass:"el",type:"error"});m(`${k.value}}成功~ Ciallo～(∠・ω< )⌒☆`,{customClass:"el",type:"success"}),b(_.value)})},z=d(),C=d(),W=d(),ee=t=>{C.value=t,z.value=t.name,Ie(()=>{W.value.focus()})},ve=()=>{Ce(C.value.path,z.value,C.value.isDir).then(t=>{const e=(C.value.mtimeMs===0?"创建":"重命名")+(C.value.isDir?"文件夹":"文件");if(te(),!t.success){m(`${e}成功失败...${t.message}`,{customClass:"el",type:"error"});return}m(`${e}成功~ Ciallo～(∠・ω< )⌒☆`,{customClass:"el",type:"success"}),b(_.value)})},te=()=>{C.value.mtimeMs===0&&p.value.splice(p.value.indexOf(C.value),1),C.value={},z.value=""},b=t=>{he(t).then(e=>{if(!e.success){m(e.message,{customClass:"el",type:"error"});return}_.value=e.data.path;const n=[];e.data.parentPath&&n.push({name:"..",path:e.data.parentPath,ext:"folder",size:"",time:"",isDir:!0});const a=[];e.data.files.forEach(o=>{o.isDir?n.push(o):a.push(o)}),p.value=[...n,...a],L.value.setScrollTop(0)})};return b(""),(t,e)=>{const n=v("el-dropdown-item"),a=v("el-dropdown-menu"),o=v("el-dropdown"),u=v("el-button"),w=v("el-input"),R=v("el-col"),I=v("el-popover"),r=v("el-popconfirm"),f=v("el-row"),x=v("el-table-column"),D=v("el-text"),h=v("el-link"),j=v("el-table"),F=v("el-card");return g(),$(F,{class:"h-[80vh]"},{default:l(()=>[s(f,{class:"flex flex-wrap"},{default:l(()=>[s(R,{xl:7,sm:12,lg:7,xs:24,class:"mr-[10px]"},{default:l(()=>[s(w,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=i=>_.value=i)},{prepend:l(()=>[s(o,{"split-button":"",disabled:!B.value.length,style:{width:"40px"},onCommand:b,onClick:e[0]||(e[0]=i=>b(B.value.shift()))},{dropdown:l(()=>[s(a,null,{default:l(()=>[(g(!0),G(we,null,be(B.value,i=>(g(),$(n,{key:i,command:i},{default:l(()=>[c(le(i),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:l(()=>[s(V(H),{icon:"mdi:arrow-left"})]),_:1},8,["disabled"])]),append:l(()=>[s(u,{onClick:e[1]||(e[1]=i=>b(_.value))},{default:l(()=>[s(V(H),{icon:"mdi:arrow-right"})]),_:1})]),_:1},8,["modelValue"])]),_:1}),S("div",Te,[s(I,{width:400,trigger:"click",visible:U.value},{reference:l(()=>[s(u,{type:"primary",class:"mr-[10px]",onClick:e[3]||(e[3]=i=>U.value=!0)},{default:l(()=>[c("上传")]),_:1})]),default:l(()=>[s(V(De),{ref_key:"uploadRef",ref:N,drag:"",action:`${V($e)()}/upload-file`,multiple:"",data:{path:_.value},"show-file-list":"","auto-upload":!1,headers:{Authorization:`Bearer ${V(Se)().accessToken}`},"on-success":pe},{tip:l(()=>[Pe,S("div",Le,[s(u,{text:"",onClick:e[4]||(e[4]=i=>U.value=!1)},{default:l(()=>[c("取消")]),_:1}),s(u,{type:"primary",loading:O.value,onClick:de},{default:l(()=>[c(" 确认 ")]),_:1},8,["loading"])])]),default:l(()=>[S("div",null,[s(V(H),{icon:"mdi:upload",width:96,class:"m-auto"})]),Ue]),_:1},8,["action","data","headers"])]),_:1},8,["visible"]),s(o,{trigger:"click",onCommand:me},{dropdown:l(()=>[s(a,null,{default:l(()=>[s(n,{command:"file"},{default:l(()=>[c(" 文件 ")]),_:1}),s(n,{command:"dir"},{default:l(()=>[c(" 文件夹 ")]),_:1})]),_:1})]),default:l(()=>[s(u,{type:"primary",class:"mr-[10px]"},{default:l(()=>[c("新建")]),_:1})]),_:1}),s(r,{title:Q.value,width:"300px",onConfirm:e[6]||(e[6]=i=>X(y.value))},{reference:l(()=>[s(u,{type:"danger",disabled:!y.value.length,onClick:e[5]||(e[5]=i=>ce(y.value))},{default:l(()=>[c("删除")]),_:1},8,["disabled"])]),_:1},8,["title"]),s(u,{type:"primary",disabled:!y.value.length||k.value=="copy",onClick:e[7]||(e[7]=i=>k.value="copy")},{default:l(()=>[c("复制")]),_:1},8,["disabled"]),s(u,{type:"primary",disabled:!y.value.length||k.value=="move",onClick:e[8]||(e[8]=i=>k.value="move")},{default:l(()=>[c("移动")]),_:1},8,["disabled"]),y.value.length?(g(),$(u,{key:0,type:"default",onClick:M},{default:l(()=>[c("取消")]),_:1})):P("",!0),k.value?(g(),$(u,{key:1,type:"success",onClick:fe},{default:l(()=>[c("粘贴")]),_:1})):P("",!0)])]),_:1}),S("div",null,[s(j,{ref_key:"tableRef",ref:L,data:p.value,"row-key":"path",height:`${se.value}vh`,onCellDblclick:K,onSelectionChange:oe,onSortChange:ie},{default:l(()=>[s(x,{type:"selection",selectable:ne,"reserve-selection":""}),c('" '),s(x,{label:"名称",sortable:"'custom'",prop:"name"},{default:l(i=>{var E;return[S("div",Me,[S("div",Oe,[(g(),$(Re(ke),{name:i.row.ext},null,8,["name"]))]),((E=C.value)==null?void 0:E.path)===i.row.path?(g(),$(w,{key:0,ref_key:"renameInputRef",ref:W,modelValue:z.value,"onUpdate:modelValue":e[9]||(e[9]=A=>z.value=A)},{append:l(()=>[s(u,{onClick:ve},{default:l(()=>[c("确认")]),_:1})]),_:1},8,["modelValue"])):(g(),$(D,{key:1},{default:l(()=>[c(le(i.row.name),1)]),_:2},1024))])]}),_:1}),s(x,{label:"大小",prop:"size",sortable:"'custom'"}),s(x,{label:"修改时间",prop:"time",sortable:"'custom'"}),s(x,{label:"操作"},{default:l(i=>{var E;return[((E=C.value)==null?void 0:E.path)!==i.row.path?(g(),G("span",Ne,[s(h,{underline:!1,onClick:A=>K(i.row)},{default:l(()=>[c("打开")]),_:2},1032,["onClick"]),i.row.name!==".."?(g(),G("span",qe,[s(h,{underline:!1,onClick:A=>ee(i.row)},{default:l(()=>[c("重命名")]),_:2},1032,["onClick"]),i.row.isDir?P("",!0):(g(),$(h,{key:0,underline:!1,onClick:A=>re(i.row)},{default:l(()=>[c("下载")]),_:2},1032,["onClick"])),s(r,{title:i.row.isDir?"确认删除这个文件夹吗？":"确认删除这个文件吗？",width:"200px",onConfirm:A=>X([i.row])},{reference:l(()=>[s(h,{underline:!1,type:"danger"},{default:l(()=>[c("删除")]),_:1})]),_:2},1032,["title","onConfirm"])])):P("",!0)])):(g(),$(h,{key:1,onClick:te},{default:l(()=>[c("取消")]),_:1}))]}),_:1})]),_:1},8,["data","height"])])]),_:1})}}}),Ke=Ee(We,[["__scopeId","data-v-87883755"]]);export{Ke as default};
